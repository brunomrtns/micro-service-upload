{"version":3,"sources":["../../src/middlewares/exceptionValidation.ts"],"sourcesContent":["import type { ErrorRequestHandler } from 'express'\n\nimport { translateText } from '@/shared'\n\nimport { ZodError } from 'zod'\nimport { AxiosError } from 'axios'\n\nconst error = async (err: any) => {\n  if (typeof err.message === 'string') {\n    return [await translateText(err.message)]\n  }\n\n  if (err.message instanceof Array) {\n    const translatedErrors = await Promise.all(err.message.map((error: string) => translateText(error)))\n\n    return translatedErrors\n  }\n\n  if (err.message instanceof Object) {\n    const translatedErrors = await Promise.all(Object.values(err.message).map((error: any) => translateText(error)))\n\n    return translatedErrors\n  }\n\n  return err\n}\n\nexport const exceptionValidation: ErrorRequestHandler = async (err, req, res, next) => {\n  if (err instanceof ZodError) {\n    return res.status(400).json({\n      errors: err.errors.map(error => `${error.path} ${error.message}`)\n    })\n  }\n\n  if (err instanceof AxiosError) {\n    return res.status(err.response?.status || 500).json({\n      errors: await error(err.response?.data)\n    })\n  }\n\n  return res.status(500).json({\n    errors: await error(err)\n  })\n}\n"],"names":["exceptionValidation","error","err","message","translateText","Array","translatedErrors","Promise","all","map","Object","values","req","res","next","ZodError","status","json","errors","path","AxiosError","response","data"],"mappings":";;;;+BA2BaA;;;eAAAA;;;wBAzBiB;qBAEL;uBACE;AAE3B,MAAMC,QAAQ,OAAOC;IACnB,IAAI,OAAOA,IAAIC,OAAO,KAAK,UAAU;QACnC,OAAO;YAAC,MAAMC,IAAAA,qBAAa,EAACF,IAAIC,OAAO;SAAE;IAC3C;IAEA,IAAID,IAAIC,OAAO,YAAYE,OAAO;QAChC,MAAMC,mBAAmB,MAAMC,QAAQC,GAAG,CAACN,IAAIC,OAAO,CAACM,GAAG,CAAC,CAACR,QAAkBG,IAAAA,qBAAa,EAACH;QAE5F,OAAOK;IACT;IAEA,IAAIJ,IAAIC,OAAO,YAAYO,QAAQ;QACjC,MAAMJ,mBAAmB,MAAMC,QAAQC,GAAG,CAACE,OAAOC,MAAM,CAACT,IAAIC,OAAO,EAAEM,GAAG,CAAC,CAACR,QAAeG,IAAAA,qBAAa,EAACH;QAExG,OAAOK;IACT;IAEA,OAAOJ;AACT;AAEO,MAAMF,sBAA2C,OAAOE,KAAKU,KAAKC,KAAKC;IAC5E,IAAIZ,eAAea,aAAQ,EAAE;QAC3B,OAAOF,IAAIG,MAAM,CAAC,KAAKC,IAAI,CAAC;YAC1BC,QAAQhB,IAAIgB,MAAM,CAACT,GAAG,CAACR,CAAAA,QAAS,CAAC,EAAEA,MAAMkB,IAAI,CAAC,CAAC,EAAElB,MAAME,OAAO,CAAC,CAAC;QAClE;IACF;IAEA,IAAID,eAAekB,iBAAU,EAAE;QAC7B,OAAOP,IAAIG,MAAM,CAACd,IAAImB,QAAQ,EAAEL,UAAU,KAAKC,IAAI,CAAC;YAClDC,QAAQ,MAAMjB,MAAMC,IAAImB,QAAQ,EAAEC;QACpC;IACF;IAEA,OAAOT,IAAIG,MAAM,CAAC,KAAKC,IAAI,CAAC;QAC1BC,QAAQ,MAAMjB,MAAMC;IACtB;AACF"}